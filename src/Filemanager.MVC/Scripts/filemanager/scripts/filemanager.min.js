/**
 *	Filemanager JS core
 *
 *	filemanager.js
 *
 *	@license	MIT License
 *	@author		Jason Huck - Core Five Labs
 *	@author		Simon Georget <simon (at) linea21 (dot) com>
 *	@copyright	Authors
 */
(function(n){function ct(n){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t)throw new Error("XMLHttpRequest not supported");return(t.open("HEAD",n,!1),t.send(null),t.status==200)?!0:!1}function s(t,i){return t["File Type"]=="dir"&&(i=="download"||i=="replace")?!1:typeof t.Capabilities=="undefined"?!0:n.inArray(i,t.Capabilities)>-1}function l(t){var r=t.attr("class").replace(/ /g,"_"),i;return r==""?"itemOptions":(n("#"+r).length||(i=n("#itemOptions").clone().attr("id",r),t.hasClass("cap_select")||n(".select",i).remove(),t.hasClass("cap_download")||n(".download",i).remove(),t.hasClass("cap_rename")||n(".rename",i).remove(),t.hasClass("cap_move")||n(".move",i).remove(),n(".replace",i).remove(),t.hasClass("cap_delete")||n(".delete",i).remove(),n("#itemOptions").after(i)),r)}var f,u,t,st;n.urlParam=function(n){var t=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(window.location.href);return t?t[1]:0};var d=function(t){var i=null,r;return t=typeof t=="undefined"?"user":t,r=t=="user"?"./scripts/filemanager.config.js":"./scripts/filemanager.config.js.default",n.ajax({async:!1,url:r,dataType:"json",cache:!1,success:function(n){i=n}}),i},ht=d("default"),r=d(),r=n.extend({},ht,r);HEAD_included_files=[];loadCSS=function(t){if(n.inArray(t,HEAD_included_files)==-1){var i=n("<link rel='stylesheet' type='text/css' href='"+t+"'>");n("head").append(i);HEAD_included_files.push(t)}};loadJS=function(t){if(n.inArray(t,HEAD_included_files)==-1){var i=n("<script type='text/javascript' src='"+t+"'>");n("head").append(i);HEAD_included_files.push(t)}};f=r.options.fileConnector||"connectors/"+r.options.lang+"/filemanager."+r.options.lang;u=r.options.capabilities||["select","download","rename","move","delete","replace"];n.urlParam("langCode")!=0&&ct("scripts/languages/"+n.urlParam("langCode")+".js")&&(r.options.culture=n.urlParam("langCode"));t=[];n.ajax({url:"scripts/languages/"+r.options.culture+".js",async:!1,dataType:"json",success:function(n){t=n}});n.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:!1});var g=function(){var t=20,i,u;r.options.searchBox===!0&&(t+=33);n.urlParam("CKEditorCleanUpFuncNum")&&(t+=60);i=n(window).height()-n("#uploader").height()-t;n("#splitter, #filetree, #fileinfo, .vsplitbar").height(i);u=n("#splitter").width()-6-n("#filetree").width();n("#fileinfo").width(u)},h=function(n,t){if(t=typeof t=="undefined"?!0:!1,r.options.showFullPath==!1){if("function"==typeof displayPathDecorator)return displayPathDecorator(n.replace(fileRoot,"/"));if(n=n.replace(fileRoot,"/"),n.length>50&&t===!0){var i=n.split("/");n="/"+i[1]+"/"+i[2]+"/(...)/"+i[i.length-2]+"/"}return n}return n},v=function(t){t=="grid"?(n("#grid").addClass("ON"),n("#list").removeClass("ON")):(n("#list").addClass("ON"),n("#grid").removeClass("ON"))};var lt=function(n,t,r){var u=String(r),f,e;for(i=0;i<n.length;i++)f=RegExp(n[i],"g"),e=t[i],u=u.replace(f,e);return u},y=function(n){var t="";return t=lt(["Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ü","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/"],["S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","u","y","y","b","y","R","r","_","_",""],n),r.options.chars_only_latin&&(t=t.replace(/[^_a-zA-Z0-9]/g,"")),t.replace(/[_]+/g,"_")},at=function(n){return filename="",filename=n.lastIndexOf(".")!=-1?y(n.substr(0,n.lastIndexOf(".")))+("."+n.split(".").pop()):y(n)},nt=function(n){for(var i=parseFloat(n),r=parseFloat(1024),u=0,f=[t.bytes,t.kb,t.mb,t.gb];;){if(i<r)return i=Math.round(i*100)/100,i+f[u];i/=r;u+=1}},tt=function(t){n("#fileinfo").html("<h1>"+t+"<\/h1>");n("#newfile").attr("disabled","disabled");n("#upload").attr("disabled","disabled");n("#newfolder").attr("disabled","disabled")};var it=function(t){return r.security.uploadPolicy=="DISALLOW_ALL"&&n.inArray(o(t),r.security.uploadRestrictions)!=-1?!0:r.security.uploadPolicy=="ALLOW_ALL"&&n.inArray(o(t),r.security.uploadRestrictions)==-1?!0:!1},fi=function(n,t){var i=n.replace(/^.*[\/\\]/g,"");return typeof t=="string"&&i.substr(i.length-t.length)==t&&(i=i.substr(0,i.length-t.length)),i},o=function(n){return n.split(".").length==1?"":n.split(".").pop().toLowerCase()},vt=function(n){return n.lastIndexOf(".")!=-1?n.substring(0,n.lastIndexOf(".")):n},yt=function(t){return n.inArray(o(t),r.edit.editExt)!=-1?!0:!1},ei=function(t){return n.inArray(o(t),r.images.imagesExt)!=-1?!0:!1},pt=function(t){return n.inArray(o(t),r.videos.videosExt)!=-1?!0:!1},wt=function(t){return n.inArray(o(t),r.audios.audiosExt)!=-1?!0:!1},bt=function(t){var i="<video width="+r.videos.videosPlayerWidth+" height="+r.videos.videosPlayerHeight+' src="'+t.Path+'" controls="controls">';i+='<img src="'+t.Preview+'" />';i+="<\/video>";n("#fileinfo img").remove();n("#fileinfo #preview h1").before(i)},kt=function(t){var i='<audio src="'+t.Path+'" controls="controls">';i+='<img src="'+t.Preview+'" />';i+="<\/audio>";n("#fileinfo img").remove();n("#fileinfo #preview h1").before(i)},dt=function(t){n("#fileinfo").find("td:first-child").each(function(){var r=n(this).attr("data-path"),i=n("#filetree").find('a[data-path="'+r+'"]').parent();typeof i.css("background-image")!="undefined"&&(n(this).css("background-image",i.css("background-image")),window.clearInterval(t))})},p=function(i){n("#currentpath").val(i);n("#uploader h1").text(t.current_folder+h(i)).attr("title",h(i,!1)).attr("data-path",i);n("#newfolder").unbind().click(function(){var i=t.default_foldername,u=t.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+i+'" />',o=function(r,u){var o,s;if(r!=1)return!1;o=u.children("#fname").val();o!=""?(i=y(o),s=new Date,n.getJSON(f+"?mode=addfolder&path="+n("#currentpath").val()+"&name="+i+"&time="+s.getMilliseconds(),function(t){t.Code==0?(ri(t.Parent,t.Name),e(t.Parent),n("#filetree").find('a[data-path="'+t.Parent+'/"]').click().click()):n.prompt(t.Error)})):n.prompt(t.no_foldername)},r={};r[t.create_folder]=!0;r[t.cancel]=!1;n.prompt(u,{callback:o,buttons:r})})},rt=function(i){n("#fileinfo button").each(function(){n(this).find("span").length==0&&n(this).wrapInner("<span><\/span>")});s(i,"select")?(n("#fileinfo").find("button#select").click(function(){w(i)}).show(),(window.opener||window.tinyMCEPopup)&&(n("#preview img").attr("title",t.select),n("#preview img").click(function(){w(i)}).css("cursor","pointer"))):n("#fileinfo").find("button#select").hide();s(i,"rename")?n("#fileinfo").find("button#rename").click(function(){var t=ut(i);t.length&&n("#fileinfo > h1").text(t)}).show():n("#fileinfo").find("button#rename").hide();s(i,"move")?n("#fileinfo").find("button#move").click(function(){var t=et(i);t.length&&n("#fileinfo > h1").text(t)}).show():n("#fileinfo").find("button#move").hide();s(i,"replace")?n("#fileinfo").find("button#replace").click(function(){ft(i)}).show():n("#fileinfo").find("button#replace").hide();s(i,"delete")?n("#fileinfo").find("button#delete").click(function(){ot(i)&&n("#fileinfo").html("<h1>"+t.select_from_left+"<\/h1>")}).show():n("#fileinfo").find("button#delete").hide();s(i,"download")?n("#fileinfo").find("button#download").click(function(){window.location=f+"?mode=download&path="+encodeURIComponent(i.Path)}).show():n("#fileinfo").find("button#download").hide()},c=function(){n("#filetree").fileTree({root:fileRoot,datafunc:ui,multiFolder:!1,folderCallback:function(n){e(n)},expandedFolder:fullexpandedFolder,after:function(){n("#filetree").find("li a").each(function(){n(this).contextMenu({menu:l(n(this))},function(t,i){var r=n(i).attr("data-path");a(t,r)})});r.options.searchBox==!0&&(n("#q").liveUpdate("#filetree ul").blur(),n("#search span.q-inactive").html(t.search),n("#search a.q-reset").attr("title",t.search_reset))}},function(n){k(n)})},w=function(i){var u,f;if(u=r.options.relPath!==!1?relPath+i.Path.replace(fileRoot,""):relPath+i.Path,window.opener||window.tinyMCEPopup||n.urlParam("field_name")||n.urlParam("CKEditorCleanUpFuncNum")||n.urlParam("CKEditor")){if(window.tinyMCEPopup){f=tinyMCEPopup.getWindowArg("window");f.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=u;typeof f.ImageDialog!="undefined"&&(f.ImageDialog.getImageData&&f.ImageDialog.getImageData(),f.ImageDialog.showPreviewImage&&f.ImageDialog.showPreviewImage(u));tinyMCEPopup.close();return}if(n.urlParam("field_name"))parent.document.getElementById(n.urlParam("field_name")).value=u,typeof parent.tinyMCE!="undefined"&&parent.tinyMCE.activeEditor.windowManager.close(),typeof parent.$.fn.colorbox!="undefined"&&parent.$.fn.colorbox.close();else if(n.urlParam("CKEditor"))window.opener?window.opener.CKEDITOR.tools.callFunction(n.urlParam("CKEditorFuncNum"),u):(parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorFuncNum"),u),parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorCleanUpFuncNum")));else if(i.Properties.Width!=""){var e=u,o=i.Properties.Width,s=i.Properties.Height;window.opener.SetUrl(e,o,s)}else window.opener.SetUrl(u);window.opener&&window.close()}else n.prompt(t.fck_select_integration)},ut=function(i){var e="",s=r.security.allowChangeExtensions?i.Filename:vt(i.Filename),h=t.new_filename+' : <input id="rname" name="rname" type="text" value="'+s+'" />',c=function(u,s){var c,a,l,h,v;if(u!=1)return!1;if(rname=s.children("#rname").val(),rname!=""){if(c=rname,r.security.allowChangeExtensions||(c=at(rname),a=o(i.Filename),a.length>0&&(c=c+"."+a)),!it(c))return l="<p>"+t.INVALID_FILE_TYPE+"<\/p>",r.security.uploadPolicy=="DISALLOW_ALL"&&(l+="<p>"+t.ALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".<\/p>"),r.security.uploadPolicy=="ALLOW_ALL"&&(l+="<p>"+t.DISALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".<\/p>"),n("#filepath").val(""),n.prompt(l),!1;h=i.Path;v=f+"?mode=rename&old="+i.Path+"&new="+c;n.ajax({type:"GET",url:v,dataType:"json",async:!1,success:function(u){var o,f,s;u.Code==0?(o=u["New Path"],f=u["New Name"],ti(h,o,f),s=n("#preview h1").attr("title"),typeof s!="undefined"&&s==h&&n("#preview h1").text(f),n("#fileinfo").data("view")=="grid"?(n('#fileinfo img[data-path="'+h+'"]').parent().next("p").text(f),n('#fileinfo img[data-path="'+h+'"]').attr("data-path",o)):(n('#fileinfo td[data-path="'+h+'"]').text(f),n('#fileinfo td[data-path="'+h+'"]').attr("data-path",o)),n("#preview h1").html(f),i.Path=o,i.Filename=f,n("#fileinfo").find("button#rename, button#delete, button#download").unbind(),rt(i),r.options.showConfirmation&&n.prompt(t.successful_rename)):n.prompt(u.Error);e=u["New Name"]}})}},u={};return u[t.rename]=!0,u[t.cancel]=!1,n.prompt(h,{callback:c,buttons:u}),e},ft=function(i){n("#fileR").bind("change",function(){n(this).closest("form#toolbar").submit()});n("#toolbar").attr("action",f);n("#toolbar").attr("method","post");n("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(u,f){var e=n("#fileR",f).val(),s;return e==""?!1:o(e)!=i["File Type"]?(n.prompt(t.ERROR_REPLACING_FILE+" ."+o(i.Filename)),!1):(n("#replace").attr("disabled",!0),n("#upload span").addClass("loading").text(t.loading_data),typeof FileReader!="undefined"&&typeof r.upload.fileSizeLimit!="auto"&&(s=n("#fileR",f).get(0).files[0].size,s>r.upload.fileSizeLimit*1048576)?(n.prompt("<p>"+t.file_too_big+"<\/p><p>"+t.file_size_limit+r.upload.fileSizeLimit+" "+t.mb+".<\/p>"),n("#upload").removeAttr("disabled").find("span").removeClass("loading").text(t.upload),!1):void 0)},error:function(){n("#upload").removeAttr("disabled").find("span").removeClass("loading").text(t.upload);n.prompt(t.ERROR_UPLOADING_FILE)},success:function(){var i=jQuery.parseJSON(n("#uploadresponse").find("textarea").text()),u;i.Code==0?(u=i.Path+"/"+i.Name,k(u),n("#preview").find("img").hide().fadeIn("slow"),n("ul.jqueryFileTree").find('li a[data-path="'+u+'"]').parent().hide().fadeIn("slow"),r.options.showConfirmation&&n.prompt(t.successful_replace)):n.prompt(i.Error);n("#replace").removeAttr("disabled");n("#upload span").removeClass("loading").text(t.upload)}});n("#newfilepath").val(i.Path);n("#fileR").click()},et=function(i){var o="",s=t.move+' : <input id="rname" name="rname" type="text" value="" />',h=function(u,s){if(u!=1)return!1;if(rname=s.children("#rname").val(),rname!=""){var h=rname,a=i.Path,l=f+"?mode=move&old="+encodeURIComponent(i.Path)+"&new="+encodeURIComponent(h)+"&root="+encodeURIComponent(fileRoot);n.ajax({type:"GET",url:l,dataType:"json",async:!1,success:function(i){if(i.Code==0){var u=i["New Path"],f=i["New Name"];fullexpandedFolder=u;c();e(u);r.options.showConfirmation&&n.prompt(t.successful_moved)}else n.prompt(i.Error);o=u+f}})}},u={};return u[t.move]=!0,u[t.cancel]=!1,n.prompt(s,{callback:h,buttons:u}),o},ot=function(i){var u=!1,o=t.confirmation_delete,s=function(e){if(e!=1)return!1;var o=new Date,s=f+"?mode=delete&path="+encodeURIComponent(i.Path)+"&time="+o.getMilliseconds(),c=i.Path.split("/").reverse().slice(1).reverse().join("/")+"/";n.ajax({type:"GET",url:s,dataType:"json",async:!1,success:function(i){if(i.Code==0){ii(i.Path);var f=i.Path.substring(0,i.Path.length-1);f=f.substr(0,f.lastIndexOf("/")+1);n("#uploader h1").text(t.current_folder+h(f)).attr("title",h(f,!1)).attr("data-path",f);u=!0;r.options.showConfirmation&&n.prompt(t.successful_delete);n("#filetree").find('a[data-path="'+c+'/"]').click().click()}else u=!1,n.prompt(i.Error)}})},e={};return e[t.yes]=!0,e[t.no]=!1,n.prompt(o,{callback:s,buttons:e}),u},gt=function(i){return isEdited=!1,n("#fileinfo").find("h1").append(' <a id="edit-file" href="#" title="'+t.edit+'"><span>'+t.edit+"<\/span><\/a>"),n("#edit-file").click(function(){n(this).hide();var u=new Date,e=f+"?mode=editfile&path="+encodeURIComponent(i.Path)+"&time="+u.getMilliseconds();n.ajax({type:"GET",url:e,dataType:"json",async:!1,success:function(u){if(u.Code==0){var e='<form id="edit-form">';e+='<textarea id="edit-content" name="content">'+u.Content+"<\/textarea>";e+='<input type="hidden" name="mode" value="savefile" />';e+='<input type="hidden" name="path" value="'+i.Path+'" />';e+='<button id="edit-cancel" class="edition" type="button">'+t.quit_editor+"<\/button>";e+='<button id="edit-save" class="edition" type="button">'+t.save+"<\/button>";e+="<\/form>";n("#preview").find("img").hide();n("#preview").prepend(e).hide().fadeIn();n("#edit-cancel").click(function(){n("#preview").find("form#edit-form").hide();n("#preview").find("img").fadeIn();n("#edit-file").show()});n("#edit-save").click(function(){var r=codeMirrorEditor.getValue(),i;n("textarea#edit-content").val(r);i=n("#edit-form").serializeArray();n.ajax({type:"POST",url:f,dataType:"json",data:i,async:!1,success:function(i){i.Code==0?(isEdited=!0,n.prompt(t.successful_edit)):(isEdited=!1,n.prompt(i.Error))}})});codeMirrorEditor=instantiateCodeMirror(o(i.Path),r)}else isEdited=!1,n.prompt(u.Error),n(this).show()}})}),isEdited},ni=function(i,u){var l=o(u),s=n("#filetree").find('a[data-path="'+i+'"]'),f=s.parent(),h='<li class="file ext_'+l+'"><a data-path="'+i+u+'" href="#" class="">'+u+"<\/a><\/li>";f.find("ul").size()?(f.find("ul").prepend(h),s.click().click()):(f=n("#filetree").find("ul.jqueryFileTree"),f.prepend(h),c());e(i);r.options.showConfirmation&&n.prompt(t.successful_added_file)},ti=function(t,i,r){var u=n("#filetree").find('a[data-path="'+t+'"]'),f=u.parent().parent().prev("a");u.attr("data-path",i).text(r);f.length==0?c():f.click().click()},ii=function(t){if(n("#filetree").find('a[data-path="'+t+'"]').parent().fadeOut("slow",function(){n(this).remove()}),n("#uploader h1").attr("data-path")==t){var i=t.split("/"),r=i.slice(0,length-2).join("/")+"/";e(r)}n("#fileinfo").data("view")=="grid"?n('#contents img[data-path="'+t+'"]').parent().parent().fadeOut("slow",function(){n(this).remove()}):n("table#contents").find('td[data-path="'+t+'"]').parent().fadeOut("slow",function(){n(this).remove()});n("#preview").length&&e(t.substr(0,t.lastIndexOf("/")+1))},ri=function(i,u){var f='<li class="directory collapsed"><a data-path="'+i+u+'/" href="#">'+u+'<\/a><ul class="jqueryFileTree" style="display: block;"><\/ul><\/li>',o=n("#filetree").find('a[data-path="'+i+'"]');i!=fileRoot?o.next("ul").prepend(f).prev("a").click().click():(n("#filetree > ul").prepend(f),n("#filetree").find('li a[data-path="'+i+u+'/"]').attr("class","cap_rename cap_delete").click(function(){e(i+u+"/")}).each(function(){n(this).contextMenu({menu:l(n(this))},function(t,i){var r=n(i).attr("data-path");a(t,r)})}));r.options.showConfirmation&&n.prompt(t.successful_added_folder)},b=function(t){t.lastIndexOf("/")==t.length-1?(e(t),n("#filetree").find('a[data-path="'+t+'"]').click()):k(t)};var a=function(t,i){var r=new Date;n.getJSON(f+"?mode=getinfo&path="+i+"&time="+r.getMilliseconds(),function(i){var e,u;e=n("#fileinfo").data("view")=="grid"?n("#fileinfo").find('img[data-path="'+i.Path+'"]').parent():n("#fileinfo").find('td[data-path="'+i.Path+'"]').parent();switch(t){case"select":w(i);break;case"download":window.location=f+"?mode=download&path="+i.Path+"&time="+r.getMilliseconds();break;case"rename":u=ut(i);break;case"replace":ft(i);break;case"move":u=et(i);break;case"delete":ot(i)}})},k=function(i){var s=i.substr(0,i.lastIndexOf("/")+1),o,h;p(s);o='<div id="preview"><img /><h1><\/h1><dl><\/dl><\/div>';o+='<form id="toolbar">';o+='<button id="parentfolder">'+t.parentfolder+"<\/button>";n.inArray("select",u)!=-1&&(n.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||n.urlParam("field_name"))&&(o+='<button id="select" name="select" type="button" value="Select">'+t.select+"<\/button>");n.inArray("download",u)!=-1&&(o+='<button id="download" name="download" type="button" value="Download">'+t.download+"<\/button>");n.inArray("rename",u)!=-1&&r.options.browseOnly!=!0&&(o+='<button id="rename" name="rename" type="button" value="Rename">'+t.rename+"<\/button>");n.inArray("move",u)!=-1&&r.options.browseOnly!=!0&&(o+='<button id="move" name="move" type="button" value="Move">'+t.move+"<\/button>");n.inArray("delete",u)!=-1&&r.options.browseOnly!=!0&&(o+='<button id="delete" name="delete" type="button" value="Delete">'+t.del+"<\/button>");n.inArray("replace",u)!=-1&&r.options.browseOnly!=!0&&(o+='<button id="replace" name="replace" type="button" value="Replace">'+t.replace+"<\/button>",o+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /><\/div>',o+='<input id="mode" name="mode" type="hidden" value="replace" /> ',o+='<input id="newfilepath" name="newfilepath" type="hidden" />');o+="<\/form>";n("#fileinfo").html(o);n("#parentfolder").click(function(){e(s)});h=new Date;n.getJSON(f+"?mode=getinfo&path="+encodeURIComponent(i)+"&time="+h.getMilliseconds(),function(u){if(u.Code==0){n("#fileinfo").find("h1").text(u.Filename).attr("title",i);n("#fileinfo").find("img").attr("src",u.Preview);pt(u.Filename)&&r.videos.showVideoPlayer==!0&&bt(u);wt(u.Filename)&&r.audios.showAudioPlayer==!0&&kt(u);yt(u.Filename)&&r.edit.enabled==!0&&gt(u);var f="";u.Properties.Width&&u.Properties.Width!=""&&(f+="<dt>"+t.dimensions+"<\/dt><dd>"+u.Properties.Width+"x"+u.Properties.Height+"<\/dd>");u.Properties["Date Created"]&&u.Properties["Date Created"]!=""&&(f+="<dt>"+t.created+"<\/dt><dd>"+u.Properties["Date Created"]+"<\/dd>");u.Properties["Date Modified"]&&u.Properties["Date Modified"]!=""&&(f+="<dt>"+t.modified+"<\/dt><dd>"+u.Properties["Date Modified"]+"<\/dd>");(u.Properties.Size||parseInt(u.Properties.Size)==0)&&(f+="<dt>"+t.size+"<\/dt><dd>"+nt(u.Properties.Size)+"<\/dd>");n("#fileinfo").find("dl").html(f);rt(u)}else n.prompt(u.Error)})},e=function(i){p(i);n("#fileinfo").html('<img id="activity" src="images/wait30trans.gif" width="30" height="30" />');var o=new Date,e=f+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+r.options.showThumbs+"&time="+o.getMilliseconds();n.urlParam("type")&&(e+="&type="+n.urlParam("type"));n.getJSON(e,function(i){var e="",f,o,h,c,v;if(i.Code=="-1"){tt(i.Error);return}if(i)if(n("#fileinfo").data("view")=="grid"){e+='<ul id="contents" class="grid">';for(key in i){f=i[key].Properties;o="";for(cap in u)s(i[key],u[cap])&&(o+=" cap_"+u[cap]);h=64;c=f.Width;c>1&&c<h&&(h=c);title=r.options.showTitleAttr?' title="'+i[key].Path+'"':"";e+='<li class="'+o+'"'+title+'"><div class="clip"><img src="'+i[key].Preview+'" width="'+h+'" alt="'+i[key].Path+'" data-path="'+i[key].Path+'" /><\/div><p>'+i[key].Filename+"<\/p>";f.Width&&f.Width!=""&&(e+='<span class="meta dimensions">'+f.Width+"x"+f.Height+"<\/span>");f.Size&&f.Size!=""&&(e+='<span class="meta size">'+f.Size+"<\/span>");f["Date Created"]&&f["Date Created"]!=""&&(e+='<span class="meta created">'+f["Date Created"]+"<\/span>");f["Date Modified"]&&f["Date Modified"]!=""&&(e+='<span class="meta modified">'+f["Date Modified"]+"<\/span>");e+="<\/li>"}e+="<\/ul>"}else{e+='<table id="contents" class="list">';e+='<thead><tr><th class="headerSortDown"><span>'+t.name+"<\/span><\/th><th><span>"+t.dimensions+"<\/span><\/th><th><span>"+t.size+"<\/span><\/th><th><span>"+t.modified+"<\/span><\/th><\/tr><\/thead>";e+="<tbody>";for(key in i){var y=i[key].Path,f=i[key].Properties,o="";title=r.options.showTitleAttr?' title="'+i[key].Path+'"':"";for(cap in u)s(i[key],u[cap])&&(o+=" cap_"+u[cap]);e+='<tr class="'+o+'">';e+='<td data-path="'+i[key].Path+'"'+title+'">'+i[key].Filename+"<\/td>";e+=f.Width&&f.Width!=""?"<td>"+f.Width+"x"+f.Height+"<\/td>":"<td><\/td>";e+=f.Size&&f.Size!=""?'<td><abbr title="'+f.Size+'">'+nt(f.Size)+"<\/abbr><\/td>":"<td><\/td>";e+=f["Date Modified"]&&f["Date Modified"]!=""?"<td>"+f["Date Modified"]+"<\/td>":"<td><\/td>";e+="<\/tr>"}e+="<\/tbody>";e+="<\/table>"}else e+="<h1>"+t.could_not_retrieve_folder+"<\/h1>";n("#fileinfo").html(e);n("#fileinfo").data("view")=="grid"?n("#fileinfo").find("#contents li").click(function(){var t=n(this).find("img").attr("data-path");b(t)}).each(function(){n(this).contextMenu({menu:l(n(this))},function(t,i){var r=n(i).find("img").attr("data-path");a(t,r)})}):(n("#fileinfo tbody tr").click(function(){var t=n("td:first-child",this).attr("data-path");b(t)}).each(function(){n(this).contextMenu({menu:l(n(this))},function(t,i){var r=n("td:first-child",i).attr("data-path");a(t,r)})}),n("#fileinfo").find("table").tablesorter({textExtraction:function(t){return n(t).find("abbr").size()?n(t).find("abbr").attr("title"):t.innerHTML}}),v=setInterval(function(){dt(v)},300))})},ui=function(i,e){var h=new Date,o=f+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+r.options.showThumbs+"&time="+h.getMilliseconds();n.urlParam("type")&&(o+="&type="+n.urlParam("type"));n.getJSON(o,function(n){var i="",f;if(n.Code=="-1"){tt(n.Error);return}if(n){i+='<ul class="jqueryFileTree" style="display: none;">';for(key in n){f="";for(cap in u)s(n[key],u[cap])&&(f+=" cap_"+u[cap]);n[key]["File Type"]=="dir"?i+='<li class="directory collapsed"><a href="#" class="'+f+'" data-path="'+n[key].Path+'">'+n[key].Filename+"<\/a><\/li>":r.options.listFiles&&(i+='<li class="file ext_'+n[key]["File Type"].toLowerCase()+'"><a href="#" class="'+f+'" data-path="'+n[key].Path+'">'+n[key].Filename+"<\/a><\/li>")}i+="<\/ul>"}else i+="<h1>"+t.could_not_retrieve_folder+"<\/h1>";e(i)})};n(function(){if(r.extras.extra_js)for(var i=0;i<r.extras.extra_js.length;i++)n.ajax({url:r.extras.extra_js[i],dataType:"script",async:r.extras.extra_js_async});r.edit.enabled&&(loadCSS("./scripts/CodeMirror/lib/codemirror.css"),loadCSS("./scripts/CodeMirror/theme/"+r.edit.theme+".css"),loadJS("./scripts/CodeMirror/lib/codemirror.js"),loadJS("./scripts/CodeMirror/addon/selection/active-line.js"),loadJS("./scripts/CodeMirror/dynamic-mode.js"));r.options.fileRoot?(fileRoot=r.options.serverRoot?"/"+r.options.fileRoot:r.options.fileRoot,fileRoot=fileRoot.replace(/\/\//g,"/")):fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/";relPath=r.options.relPath===!1?window.location.protocol+"//"+window.location.host:r.options.relPath;n.urlParam("exclusiveFolder")!=0&&(fileRoot+=n.urlParam("exclusiveFolder"),fileRoot.charAt(fileRoot.length-1)!="/"&&(fileRoot+="/"),fileRoot=fileRoot.replace(/\/\//g,"/"));n.urlParam("expandedFolder")!=0?(expandedFolder=n.urlParam("expandedFolder"),fullexpandedFolder=fileRoot+expandedFolder):(expandedFolder="",fullexpandedFolder=null);r.options.autoload==!0&&(n("#upload").append(t.upload),n("#newfolder").append(t.new_folder),n("#grid").attr("title",t.grid_view),n("#list").attr("title",t.list_view),n("#fileinfo h1").append(t.select_from_left),n('#itemOptions a[href$="#select"]').append(t.select),n('#itemOptions a[href$="#download"]').append(t.download),n('#itemOptions a[href$="#rename"]').append(t.rename),n('#itemOptions a[href$="#move"]').append(t.move),n('#itemOptions a[href$="#replace"]').append(t.replace),n('#itemOptions a[href$="#delete"]').append(t.del));n.urlParam("CKEditorCleanUpFuncNum")&&(n("body").append('<button id="close-btn" type="button">'+t.close+"<\/button>"),n("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(n.urlParam("CKEditorCleanUpFuncNum"))}));n("#browse").append("+");n("#browse").attr("title",t.browse);n("#newfile").change(function(){n("#filepath").val(n(this).val().replace(/.+[\\\/]/,""))});r.options.searchBox===!0?n.getScript("./scripts/filemanager.liveSearch.min.js"):n("#search").remove();n("button").wrapInner("<span><\/span>");n("#fileinfo").data("view",r.options.defaultViewMode);v(r.options.defaultViewMode);n("#home").click(function(){var t=n("#fileinfo").data("view");n("#fileinfo").data("view",t);n("#filetree>ul>li.expanded>a").trigger("click");e(fileRoot)});n("#grid").click(function(){v("grid");n("#fileinfo").data("view","grid");e(n("#currentpath").val())});n("#list").click(function(){v("list");n("#fileinfo").data("view","list");e(n("#currentpath").val())});p(fileRoot);n("#uploader").attr("action",f);n("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(i,u){var f,e,o,s;if(n("#newfile",u).val()=="")return!1;if(!it(n("#newfile",u).val()))return f="<p>"+t.INVALID_FILE_TYPE+"<\/p>",r.security.uploadPolicy=="DISALLOW_ALL"&&(f+="<p>"+t.ALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".<\/p>"),r.security.uploadPolicy=="ALLOW_ALL"&&(f+="<p>"+t.DISALLOWED_FILE_TYPE+r.security.uploadRestrictions.join(", ")+".<\/p>"),n("#filepath").val(""),n.prompt(f),!1;if(n("#upload").attr("disabled",!0),n("#upload span").addClass("loading").text(t.loading_data),n.urlParam("type").toString().toLowerCase()=="images"){e=n("#newfile",u).val().toLowerCase().split(".");o=!1;for(key in r.images.imagesExt)r.images.imagesExt[key]==e[e.length-1]&&(o=!0);if(o===!1)return n.prompt(t.UPLOAD_IMAGES_ONLY),n("#upload").removeAttr("disabled").find("span").removeClass("loading").text(t.upload),!1}if(typeof FileReader!="undefined"&&typeof r.upload.fileSizeLimit!="auto"&&(s=n("#newfile",u).get(0).files[0].size,s>r.upload.fileSizeLimit*1048576))return n.prompt("<p>"+t.file_too_big+"<\/p><p>"+t.file_size_limit+r.upload.fileSizeLimit+" "+t.mb+".<\/p>"),n("#upload").removeAttr("disabled").find("span").removeClass("loading").text(t.upload),!1},error:function(){n("#upload").removeAttr("disabled").find("span").removeClass("loading").text(t.upload);n.prompt(t.ERROR_UPLOADING_FILE)},success:function(){var i=jQuery.parseJSON(n("#uploadresponse").find("textarea").text());i.Code==0?(ni(i.Path,i.Name),n("#filepath, #newfile").val(""),n.browser.msie&&n("#newfile").replaceWith(n("#newfile").clone(!0)),n("#filetree").find('a[data-path="'+i.Path+'/"]').click().click()):n.prompt(i.Error);n("#upload").removeAttr("disabled");n("#upload span").removeClass("loading").text(t.upload);n("#filepath").val("")}});c();window.opener||window.tinyMCEPopup||n.urlParam("field_name")||n('#itemOptions a[href$="#select"]').remove();r.options.browseOnly==!0&&(n("#file-input-container").remove(),n("#upload").remove(),n("#newfolder").remove(),n("#toolbar").remove("#rename"),n(".contextMenu .rename").remove(),n(".contextMenu .move").remove(),n(".contextMenu .replace").remove(),n(".contextMenu .delete").remove());g();n(window).resize(g);n("#splitter").splitter({sizeLeft:200});b(fileRoot+expandedFolder)});st=document.documentElement;st.setAttribute("data-useragent",navigator.userAgent)})(jQuery);
/*
//# sourceMappingURL=filemanager.min.js.map
*/